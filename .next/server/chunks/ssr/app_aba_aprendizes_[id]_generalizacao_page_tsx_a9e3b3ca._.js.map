{"version":3,"sources":["../../../../app/aba/aprendizes/%5Bid%5D/generalizacao/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { useParams, useSearchParams } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface Probe { id:string; variation_number:number; context_number:number; variation_desc:string|null; context_desc:string|null; trials_total:number; trials_correct:number; score_pct:number; prompt_level:string; created_at:string }\nconst promptLabels: Record<string,string> = { independent:'Independente', gestural:'Gestual', verbal:'Verbal', modeling:'Modelagem', partial_physical:'Física parcial', full_physical:'Física total' }\n\nexport default function GeneralizacaoPage() {\n  const params = useParams(); const searchParams = useSearchParams()\n  const learnerId = params.id as string; const protocolId = searchParams.get('protocol_id')\n  const [probes, setProbes] = useState<Probe[]>([]); const [protocolTitle, setProtocolTitle] = useState('')\n  const [criteriaPct, setCriteriaPct] = useState(80); const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false); const [error, setError] = useState<string|null>(null)\n  const [success, setSuccess] = useState<string|null>(null)\n  const [selectedCell, setSelectedCell] = useState<{v:number;c:number}|null>(null)\n  const [form, setForm] = useState({ variation_desc:'', context_desc:'', trials_total:10, trials_correct:0, prompt_level:'independent', notes:'' })\n\n  const fetchProbes = useCallback(async () => {\n    if (!protocolId) return\n    try {\n      const res = await fetch(`/api/aba/generalization?protocol_id=${protocolId}`); const data = await res.json(); setProbes(data.probes || [])\n      const pRes = await fetch(`/api/aba/protocols?learner_id=${learnerId}`); const pData = await pRes.json()\n      const proto = pData.protocols?.find((p:any) => p.id === protocolId)\n      if (proto) { setProtocolTitle(proto.title); setCriteriaPct(proto.mastery_criteria_pct || 80) }\n    } catch {}; setLoading(false)\n  }, [protocolId, learnerId])\n  useEffect(() => { fetchProbes() }, [fetchProbes])\n\n  const getCell = (v:number, c:number) => {\n    const cp = probes.filter(p => p.variation_number===v && p.context_number===c)\n    const latest = cp[0] || undefined\n    return { latest, passed: latest ? latest.score_pct >= criteriaPct : false }\n  }\n\n  const handleSubmit = async () => {\n    if (!selectedCell || !protocolId) return; setSaving(true); setError(null); setSuccess(null)\n    try {\n      const res = await fetch('/api/aba/generalization', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ protocol_id:protocolId, variation_number:selectedCell.v, context_number:selectedCell.c, variation_desc:form.variation_desc||null, context_desc:form.context_desc||null, trials_total:form.trials_total, trials_correct:form.trials_correct, prompt_level:form.prompt_level, notes:form.notes||null }) })\n      const data = await res.json()\n      if (!res.ok) { setError(data.error||'Erro') } else {\n        if (data.auto_transitioned) setSuccess('Generalização completa! Protocolo → Mantido'); else setSuccess(`${data.matrix.passing_cells}/6 células aprovadas`)\n        setSelectedCell(null); setForm({ variation_desc:'', context_desc:'', trials_total:10, trials_correct:0, prompt_level:'independent', notes:'' }); fetchProbes()\n      }\n    } catch { setError('Falha de conexão') }; setSaving(false)\n  }\n\n  if (!protocolId) return <div className=\"px-4 pt-8 text-center\"><p className=\"text-slate-400 text-sm\">protocol_id ausente.</p><Link href={`/aba/aprendizes/${learnerId}`} className=\"text-xs text-aba-500 mt-2 inline-block\">← Voltar</Link></div>\n  if (loading) return <div className=\"flex items-center justify-center min-h-[40vh]\"><p className=\"text-slate-400 text-sm animate-pulse\">Carregando...</p></div>\n  const totalPassed = [1,2,3].flatMap(v => [1,2].map(c => getCell(v,c))).filter(c => c.passed).length\n\n  return (\n    <div className=\"px-4 md:px-8 lg:px-12 xl:px-16 pt-5\">\n      <Link href={`/aba/aprendizes/${learnerId}`} className=\"text-xs text-slate-400 hover:text-aba-500\">← Voltar ao aprendiz</Link>\n      <div className=\"mt-4 mb-6\"><h1 className=\"text-lg font-normal text-slate-800\">Generalização 3×2</h1><p className=\"text-xs text-slate-400\">{protocolTitle} · Critério: {criteriaPct}% · {totalPassed}/6 células</p></div>\n      {error && <div className=\"mb-4 p-3 bg-red-50 rounded-lg\"><p className=\"text-xs text-red-500\">{error}</p></div>}\n      {success && <div className=\"mb-4 p-3 bg-green-50 rounded-lg\"><p className=\"text-xs text-green-600\">{success}</p></div>}\n\n      <div className=\"mb-6\">\n        <div className=\"grid grid-cols-3 gap-px bg-slate-200 rounded-xl overflow-hidden\">\n          <div className=\"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase\">Variação</div>\n          <div className=\"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase\">Contexto 1</div>\n          <div className=\"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase\">Contexto 2</div>\n          {[1,2,3].map(v => (<>\n            <div key={`v${v}`} className=\"bg-slate-50 p-3 flex items-center justify-center\"><span className=\"text-xs font-medium text-slate-600\">V{v}</span></div>\n            {[1,2].map(c => { const cell = getCell(v,c); return (\n              <button key={`${v}-${c}`} onClick={() => setSelectedCell({v,c})} className={`p-3 text-center transition-colors ${cell.passed ? 'bg-green-50 hover:bg-green-100' : cell.latest ? 'bg-amber-50 hover:bg-amber-100' : 'bg-white hover:bg-aba-500/5'} ${selectedCell?.v===v&&selectedCell?.c===c ? 'ring-2 ring-aba-500' : ''}`}>\n                {cell.latest ? (<><p className={`text-sm font-medium ${cell.passed?'text-green-600':'text-amber-600'}`}>{cell.latest.score_pct}%</p><p className=\"text-[10px] text-slate-400\">{cell.latest.trials_correct}/{cell.latest.trials_total}</p></>) : <p className=\"text-xs text-slate-300\">Vazio</p>}\n              </button>\n            )})}\n          </>))}\n        </div>\n        <p className=\"text-[10px] text-slate-400 mt-2 text-center\">Clique numa célula para registrar probe</p>\n      </div>\n\n      {selectedCell && (\n        <div className=\"p-4 rounded-xl border border-aba-500/30 bg-aba-500/5 mb-6\">\n          <h3 className=\"text-sm font-medium text-slate-800 mb-3\">Probe — V{selectedCell.v} × C{selectedCell.c}</h3>\n          <div className=\"grid grid-cols-2 gap-3 mb-3\">\n            <div><label className=\"block text-[11px] text-slate-500 mb-1\">Descrição variação</label><input type=\"text\" value={form.variation_desc} onChange={e => setForm({...form, variation_desc:e.target.value})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" placeholder=\"Ex: Com brinquedo diferente\" /></div>\n            <div><label className=\"block text-[11px] text-slate-500 mb-1\">Descrição contexto</label><input type=\"text\" value={form.context_desc} onChange={e => setForm({...form, context_desc:e.target.value})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" placeholder=\"Ex: Na sala de espera\" /></div>\n          </div>\n          <div className=\"grid grid-cols-3 gap-3 mb-3\">\n            <div><label className=\"block text-[11px] text-slate-500 mb-1\">Total tentativas</label><input type=\"number\" min={1} value={form.trials_total} onChange={e => setForm({...form, trials_total:parseInt(e.target.value)||0})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" /></div>\n            <div><label className=\"block text-[11px] text-slate-500 mb-1\">Corretas</label><input type=\"number\" min={0} value={form.trials_correct} onChange={e => setForm({...form, trials_correct:parseInt(e.target.value)||0})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" /></div>\n            <div><label className=\"block text-[11px] text-slate-500 mb-1\">Nível de dica</label><select value={form.prompt_level} onChange={e => setForm({...form, prompt_level:e.target.value})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500 bg-white\">{Object.entries(promptLabels).map(([k,v]) => <option key={k} value={k}>{v}</option>)}</select></div>\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <button onClick={() => setSelectedCell(null)} className=\"px-3 py-1.5 text-xs text-slate-500\">Cancelar</button>\n            <button onClick={handleSubmit} disabled={saving} className=\"px-4 py-1.5 text-xs bg-aba-500 text-white rounded-lg hover:bg-aba-600 disabled:opacity-50\">{saving ? 'Salvando...' : 'Registrar Probe'}</button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGA,IAAM,EAAsC,CAAE,YAAY,eAAgB,SAAS,UAAW,OAAO,SAAU,SAAS,YAAa,iBAAiB,iBAAkB,cAAc,cAAe,EAEtL,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAAU,EAAe,CAAA,EAAA,EAAA,eAAA,AAAe,IAC1D,EAAY,EAAO,EAAE,CAAkB,EAAa,EAAa,GAAG,CAAC,eACrE,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAU,EAAE,EAAS,CAAC,EAAe,EAAiB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IAChG,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAAW,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACrF,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAAc,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACvF,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MAC9C,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,MACrE,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAE,eAAe,GAAI,aAAa,GAAI,aAAa,GAAI,eAAe,EAAG,aAAa,cAAe,MAAM,EAAG,GAEzI,EAAc,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UAC9B,GAAK,CAAD,EACJ,GAAI,CACF,IAAM,CAFS,CAEH,MAAM,MAAM,CAAC,oCAAoC,EAAE,EAAA,CAAY,EAAS,EAAO,MAAM,EAAI,IAAI,GAAI,EAAU,EAAK,MAAM,EAAI,EAAE,EACxI,IAAM,EAAO,MAAM,MAAM,CAAC,8BAA8B,EAAE,EAAA,CAAW,EAAS,EAAQ,MAAM,EAAK,IAAI,GAC/F,EAAQ,EAAM,SAAS,EAAE,KAAM,AAAD,GAAW,EAAE,EAAE,GAAK,GACpD,IAAS,EAAiB,CAAnB,CAAyB,KAAK,EAAG,EAAe,EAAM,oBAAoB,EAAI,IAC3F,CAAE,KAAM,CAAC,CAAG,EAAW,IACzB,EAAG,CAAC,EAAY,EAAU,EAC1B,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAAQ,GAAc,EAAG,CAAC,EAAY,EAEhD,IAAM,EAAU,CAAC,EAAU,KAEzB,IAAM,EADK,AACI,EADG,MAAM,CAAC,GAAK,EAAE,gBAAgB,GAAG,GAAK,EAAE,cAAc,GAAG,EAC1D,CAAC,EAAE,EAAI,OACxB,MAAO,QAAE,EAAQ,SAAQ,GAAS,EAAO,SAAS,EAAI,CAAoB,CAC5E,EAEM,EAAe,QAHiD,EAIpE,GAAI,AAAC,GAAiB,GAAoB,GAAU,GAAO,EAAS,CAAlC,CAAb,IAAsD,EAAW,MACtF,GAAI,CACF,IAAM,EAAM,MAAM,MAAM,0BAA2B,CAAE,OAAO,OAAQ,QAAQ,CAAC,eAAe,kBAAkB,EAAG,KAAM,KAAK,SAAS,CAAC,CAAE,YAAY,EAAY,iBAAiB,EAAa,CAAC,CAAE,eAAe,EAAa,CAAC,CAAE,eAAe,EAAK,cAAc,EAAE,KAAM,aAAa,EAAK,YAAY,EAAE,KAAM,aAAa,EAAK,YAAY,CAAE,eAAe,EAAK,cAAc,CAAE,aAAa,EAAK,YAAY,CAAE,MAAM,EAAK,KAAK,EAAE,IAAK,EAAG,GACxa,EAAO,MAAM,EAAI,IAAI,GACtB,EAAI,EAAE,EAAE,AACP,EAAK,iBAAiB,CAAE,EAAW,+CAAqD,EAAW,CAAA,EAAG,EAAK,MAAM,CAAC,aAAa,CAAC,uBAAoB,CAAC,EACzJ,EAAgB,MAAO,EAAQ,CAAE,eAAe,GAAI,aAAa,GAAI,aAAa,GAAI,eAAe,EAAG,aAAa,cAAe,MAAM,EAAG,GAAI,KAFpI,EAAS,EAAK,KAAK,EAAE,OAItC,CAAE,KAAM,CAAE,EAAS,mBAAoB,CAAG,GAAU,GACtD,EAEA,GAAI,CAAC,EAAY,MAAO,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCAAwB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kCAAyB,yBAAwB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAM,CAAC,gBAAgB,EAAE,EAAA,CAAW,CAAE,UAAU,kDAAyC,gBAC5N,GAAI,EAAS,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDAAgD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gDAAuC,oBACvI,IAAM,EAAc,CAAC,EAAE,EAAE,EAAE,CAAC,OAAO,CAAC,GAAK,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,GAAK,EAAQ,EAAE,KAAK,MAAM,CAAC,GAAK,EAAE,MAAM,EAAE,MAAM,CAEnG,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAM,CAAC,gBAAgB,EAAE,EAAA,CAAW,CAAE,UAAU,qDAA4C,yBAClG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBAAY,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,sBAAsB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,mCAA0B,EAAc,gBAAc,EAAY,OAAK,EAAY,mBACnM,GAAS,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCAAgC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gCAAwB,MAC7F,GAAW,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2CAAkC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kCAA0B,MAEpG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4EACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wFAA+E,aAC9F,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wFAA+E,eAC9F,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wFAA+E,eAC7F,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,CAAC,GAAM,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACjB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAkB,UAAU,4DAAmD,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,+CAAqC,IAAE,MAA7H,CAAC,CAAC,EAAE,EAAA,CAAG,EAChB,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,IAAO,IAAM,EAAO,EAAQ,EAAE,GAAI,MAC3C,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAyB,QAAS,IAAM,EAAgB,GAAC,EAAE,CAAC,GAAI,UAAW,CAAC,kCAAkC,EAAE,EAAK,MAAM,CAAG,iCAAmC,EAAK,MAAM,CAAG,iCAAmC,8BAA8B,CAAC,EAAE,GAAc,IAAI,GAAG,GAAc,IAAI,EAAI,sBAAwB,GAAA,CAAI,UACxT,EAAK,MAAM,CAAI,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WAAE,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAW,CAAC,oBAAoB,EAAE,EAAK,MAAM,CAAC,iBAAiB,iBAAA,CAAkB,WAAG,EAAK,MAAM,CAAC,SAAS,CAAC,OAAK,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA8B,EAAK,MAAM,CAAC,cAAc,CAAC,IAAE,EAAK,MAAM,CAAC,YAAY,OAAY,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kCAAyB,WAD3Q,CAAA,EAAG,EAAE,CAAC,EAAE,EAAA,CAAG,CAGzB,UAGL,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uDAA8C,+CAG5D,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sEACb,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,oDAA0C,YAAU,EAAa,CAAC,CAAC,OAAK,EAAa,CAAC,IACpG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,iDAAwC,uBAA0B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,OAAO,MAAO,EAAK,cAAc,CAAE,SAAU,GAAK,EAAQ,CAAC,GAAG,CAAI,CAAE,eAAe,EAAE,MAAM,CAAC,KAAK,GAAI,UAAU,wGAAwG,YAAY,mCACvU,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,iDAAwC,uBAA0B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,OAAO,MAAO,EAAK,YAAY,CAAE,SAAU,GAAK,EAAQ,CAAC,GAAG,CAAI,CAAE,aAAa,EAAE,MAAM,CAAC,KAAK,GAAI,UAAU,wGAAwG,YAAY,gCAErU,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,iDAAwC,qBAAwB,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,SAAS,IAAK,EAAG,MAAO,EAAK,YAAY,CAAE,SAAU,GAAK,EAAQ,CAAC,GAAG,CAAI,CAAE,aAAa,SAAS,EAAE,MAAM,CAAC,KAAK,GAAG,CAAC,GAAI,UAAU,6GACpO,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,iDAAwC,aAAgB,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,SAAS,IAAK,EAAG,MAAO,EAAK,cAAc,CAAE,SAAU,GAAK,EAAQ,CAAC,GAAG,CAAI,CAAE,eAAe,SAAS,EAAE,MAAM,CAAC,KAAK,GAAG,CAAC,GAAI,UAAU,6GAChO,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,iDAAwC,kBAAqB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAO,EAAK,YAAY,CAAE,SAAU,GAAK,EAAQ,CAAC,GAAG,CAAI,CAAE,aAAa,EAAE,MAAM,CAAC,KAAK,GAAI,UAAU,0HAAkH,OAAO,OAAO,CAAC,GAAc,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,GAAK,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAe,MAAO,WAAI,GAAd,YAE5W,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mCACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,IAAM,EAAgB,MAAO,UAAU,8CAAqC,aAC7F,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,EAAc,SAAU,EAAQ,UAAU,qGAA6F,EAAS,cAAgB,4BAM7L"}