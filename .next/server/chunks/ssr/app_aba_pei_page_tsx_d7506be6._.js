module.exports=[63613,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246);let e={draft:"Rascunho",active:"Ativo",completed:"Concluído",archived:"Arquivado"},f={draft:"bg-slate-100 text-slate-500",active:"bg-green-50 text-green-600",completed:"bg-blue-50 text-blue-600",archived:"bg-slate-50 text-slate-400"},g={draft:"Rascunho",active:"Ativo",mastered:"Dominado",generalization:"Generalização",maintained:"Mantido",archived:"Arquivado",suspended:"Suspenso",discontinued:"Descontinuado"};function h(){let[a,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)({learner_id:"",title:"",start_date:new Date().toISOString().split("T")[0]}),[u,v]=(0,c.useState)([{title:"",domain:"Comunicação",target_pct:80,notes:""}]),w=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/aba/pei"),b=await a.json();h(b.plans||[]),j(!1)}catch{l("Falha ao carregar"),j(!1)}},[]);(0,c.useEffect)(()=>{w()},[w]),(0,c.useEffect)(()=>{m&&0===o.length&&fetch("/api/aba/learners").then(a=>a.json()).then(a=>p(a.learners||[])).catch(()=>{})},[m,o.length]);let x=(a,b,c)=>{let d=[...u];d[a]={...d[a],[b]:c},v(d)},y=async()=>{if(!s.learner_id||!s.title)return void l("Preencha aprendiz e título");let a=u.filter(a=>a.title.trim());if(0===a.length)return void l("Adicione pelo menos 1 meta");r(!0),l(null);try{let b=await fetch("/api/aba/pei",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,goals:a})});if(!b.ok){let a=await b.json();l(a.error||"Erro"),r(!1);return}n(!1),t({learner_id:"",title:"",start_date:new Date().toISOString().split("T")[0]}),v([{title:"",domain:"Comunicação",target_pct:80,notes:""}]),await w()}catch{l("Falha de conexão")}r(!1)},z=["Comunicação","Social","Acadêmico","Autocuidado","Motor","Comportamento","Brincar","Cognitivo"];return i?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,b.jsx)("div",{className:"animate-pulse text-slate-400 text-sm",children:"Carregando..."})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex justify-center pt-5 md:pt-6 mb-6 md:mb-8 px-4",children:(0,b.jsxs)("nav",{className:"inline-flex items-center gap-1 bg-white border border-slate-200 rounded-full px-3 md:px-5 py-1.5 shadow-sm",children:[(0,b.jsx)(d.default,{href:"/aba",className:"px-3 py-1 text-sm font-medium text-slate-400 hover:text-slate-600 transition-colors",children:"Painel"}),(0,b.jsx)("span",{className:"text-slate-300 text-xs",children:"·"}),(0,b.jsx)(d.default,{href:"/aba/aprendizes",className:"px-3 py-1 text-sm font-medium text-slate-400 hover:text-slate-600 transition-colors",children:"Aprendizes"}),(0,b.jsx)("span",{className:"text-slate-300 text-xs",children:"·"}),(0,b.jsx)(d.default,{href:"/aba/pei",className:"px-3 py-1 text-sm font-medium text-aba-500",children:"PEI"})]})}),(0,b.jsxs)("div",{className:"px-4 md:px-8 lg:px-12 xl:px-16",children:[(0,b.jsxs)("header",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-lg font-normal text-slate-400 tracking-tight mb-0",children:"Plano Educacional Individualizado"}),(0,b.jsx)("p",{className:"text-xs text-slate-300 font-light",children:"Metas semestrais vinculadas aos protocolos ABA"})]}),k&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:(0,b.jsx)("p",{className:"text-xs text-red-500",children:k})}),(0,b.jsxs)("div",{className:"max-w-4xl",children:[(0,b.jsx)("button",{onClick:()=>n(!0),className:"w-full p-3 rounded-xl border-2 border-dashed border-aba-500/30 text-aba-500 text-sm font-medium hover:bg-aba-500/5 transition-colors mb-6",children:"+ Novo PEI"}),0===a.length?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-aba-500/10 flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-aba-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Nenhum PEI cadastrado"}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"Crie um Plano Educacional Individualizado para começar"})]}):(0,b.jsx)("div",{className:"space-y-6",children:a.map(a=>{let c=a.goals.filter(b=>a.linked_protocols.filter(a=>a.pei_goal_id===b.id).some(a=>["mastered","generalization","maintained","archived"].includes(a.status))).length;return(0,b.jsxs)("div",{className:"border border-slate-200 rounded-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-sm font-medium text-slate-700",children:a.title}),(0,b.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full "+(f[a.status]||"bg-slate-100 text-slate-500"),children:e[a.status]||a.status})]}),(0,b.jsxs)("p",{className:"text-xs text-slate-400 mt-0.5",children:[a.learner_name," · Início: ",new Date(a.start_date).toLocaleDateString("pt-BR"),a.end_date?" · Fim: "+new Date(a.end_date).toLocaleDateString("pt-BR"):""]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-lg font-medium text-aba-500",children:[c,"/",a.goals.length]}),(0,b.jsx)("p",{className:"text-[10px] text-slate-400",children:"metas atingidas"})]})]}),(0,b.jsxs)("div",{className:"p-5",children:[(0,b.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 mb-4",children:(0,b.jsx)("div",{className:"bg-aba-500 h-2 rounded-full transition-all",style:{width:a.goals.length>0?c/a.goals.length*100+"%":"0%"}})}),(0,b.jsx)("div",{className:"space-y-3",children:a.goals.map(c=>{let d=a.linked_protocols.filter(a=>a.pei_goal_id===c.id),e=d.some(a=>["mastered","generalization","maintained","archived"].includes(a.status));return(0,b.jsxs)("div",{className:"p-3 rounded-lg border "+(e?"border-green-200 bg-green-50/50":"border-slate-200"),children:[(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 "+(e?"bg-green-100":"bg-slate-100"),children:e?(0,b.jsx)("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):(0,b.jsx)("span",{className:"w-2 h-2 rounded-full bg-slate-300"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-medium text-slate-700",children:c.title}),(0,b.jsxs)("p",{className:"text-[10px] text-slate-400",children:[c.domain," · Meta: ",c.target_pct,"%"]}),c.notes&&(0,b.jsx)("p",{className:"text-[10px] text-slate-400 italic mt-0.5",children:c.notes})]})]})}),d.length>0&&(0,b.jsx)("div",{className:"mt-2 ml-7 flex flex-wrap gap-1",children:d.map(a=>(0,b.jsxs)("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-aba-500/10 text-aba-500",children:[a.title," · ",g[a.status]||a.status]},a.id))}),0===d.length&&(0,b.jsx)("p",{className:"mt-1 ml-7 text-[10px] text-slate-300 italic",children:"Nenhum protocolo vinculado"})]},c.id)})})]})]},a.id)})})]})]}),m&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",onClick:()=>n(!1),children:(0,b.jsx)("div",{className:"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-slate-800",children:"Novo PEI"}),(0,b.jsx)("button",{onClick:()=>n(!1),className:"text-slate-400 hover:text-slate-600 text-xl leading-none",children:"×"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Aprendiz *"}),(0,b.jsxs)("select",{value:s.learner_id,onChange:a=>t({...s,learner_id:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500 bg-white",children:[(0,b.jsx)("option",{value:"",children:"Selecione"}),o.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Título do PEI *"}),(0,b.jsx)("input",{type:"text",value:s.title,onChange:a=>t({...s,title:a.target.value}),placeholder:"Ex: PEI Semestre 1 - 2026",className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Data de início *"}),(0,b.jsx)("input",{type:"date",value:s.start_date,onChange:a=>t({...s,start_date:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-slate-600",children:"Metas *"}),(0,b.jsx)("button",{onClick:()=>{v([...u,{title:"",domain:"Comunicação",target_pct:80,notes:""}])},className:"text-[11px] text-aba-500 hover:text-aba-600 font-medium",children:"+ Adicionar meta"})]}),(0,b.jsx)("div",{className:"space-y-3",children:u.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 border border-slate-200 rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-[10px] text-slate-400",children:["Meta ",c+1]}),u.length>1&&(0,b.jsx)("button",{onClick:()=>{u.length>1&&v(u.filter((a,b)=>b!==c))},className:"text-[10px] text-red-400 hover:text-red-500",children:"Remover"})]}),(0,b.jsx)("input",{type:"text",value:a.title,onChange:a=>x(c,"title",a.target.value),placeholder:"Descrição da meta",className:"w-full px-3 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("select",{value:a.domain,onChange:a=>x(c,"domain",a.target.value),className:"flex-1 px-2 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500 bg-white",children:z.map(a=>(0,b.jsx)("option",{value:a,children:a},a))}),(0,b.jsx)("input",{type:"number",min:50,max:100,value:a.target_pct,onChange:a=>x(c,"target_pct",parseInt(a.target.value)||80),className:"w-20 px-2 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500",placeholder:"%"})]})]},c))})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 mt-6 pt-4 border-t border-slate-100",children:[(0,b.jsx)("button",{onClick:()=>n(!1),className:"flex-1 px-4 py-2 rounded-lg border border-slate-200 text-sm text-slate-500 hover:bg-slate-50",children:"Cancelar"}),(0,b.jsx)("button",{onClick:y,disabled:q,className:"flex-1 px-4 py-2 rounded-lg bg-aba-500 text-white text-sm font-medium hover:bg-aba-500/90 disabled:opacity-50 transition-colors",children:q?"Criando...":"Criar PEI"})]})]})})})]})}a.s(["default",()=>h])}];

//# sourceMappingURL=app_aba_pei_page_tsx_d7506be6._.js.map