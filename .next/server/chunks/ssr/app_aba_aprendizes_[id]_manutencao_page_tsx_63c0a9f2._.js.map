{"version":3,"sources":["../../../../app/aba/aprendizes/%5Bid%5D/manutencao/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { useParams, useSearchParams } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface Probe { id:string; protocol_id:string; protocol_title:string; learner_name:string; week_number:number; label:string; scheduled_at:string; status:string; result:string|null; trials_total:number|null; trials_correct:number|null; score_pct:number|null; evaluated_at:string|null }\nconst promptLabels: Record<string,string> = { independent:'Independente', gestural:'Gestual', verbal:'Verbal', modeling:'Modelagem', partial_physical:'Física parcial', full_physical:'Física total' }\n\nexport default function ManutencaoPage() {\n  const params = useParams(); const searchParams = useSearchParams()\n  const learnerId = params.id as string; const protocolId = searchParams.get('protocol_id')\n  const [probes, setProbes] = useState<Probe[]>([]); const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState<string|null>(null); const [error, setError] = useState<string|null>(null)\n  const [success, setSuccess] = useState<string|null>(null); const [evaluating, setEvaluating] = useState<string|null>(null)\n  const [form, setForm] = useState({ trials_total:10, trials_correct:0, prompt_level:'independent', notes:'' })\n\n  const fetchProbes = useCallback(async () => {\n    let url = `/api/aba/maintenance?learner_id=${learnerId}`\n    if (protocolId) url += `&protocol_id=${protocolId}`\n    try { const res = await fetch(url); const data = await res.json(); setProbes(data.probes || []) } catch {}; setLoading(false)\n  }, [learnerId, protocolId])\n  useEffect(() => { fetchProbes() }, [fetchProbes])\n\n  const handleSchedule = async () => {\n    if (!protocolId) return; setSaving('schedule'); setError(null)\n    try {\n      const res = await fetch('/api/aba/maintenance', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'schedule', protocol_id:protocolId }) })\n      const data = await res.json()\n      if (!res.ok) setError(data.error||'Erro'); else { setSuccess(`${data.scheduled} sonda(s) agendada(s)`); fetchProbes() }\n    } catch { setError('Falha de conexão') }; setSaving(null)\n  }\n\n  const handleEvaluate = async (probeId: string) => {\n    setSaving(probeId); setError(null); setSuccess(null)\n    try {\n      const res = await fetch('/api/aba/maintenance', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'evaluate', probe_id:probeId, trials_total:form.trials_total, trials_correct:form.trials_correct, prompt_level:form.prompt_level, notes:form.notes||null }) })\n      const data = await res.json()\n      if (!res.ok) setError(data.error||'Erro'); else {\n        if (data.regression) setSuccess(`Sonda falhou (${data.score_pct}%). Regressão — protocolo voltou para Ativo.`); else setSuccess(`Sonda aprovada (${data.score_pct}%)!`)\n        setEvaluating(null); setForm({ trials_total:10, trials_correct:0, prompt_level:'independent', notes:'' }); fetchProbes()\n      }\n    } catch { setError('Falha de conexão') }; setSaving(null)\n  }\n\n  if (loading) return <div className=\"flex items-center justify-center min-h-[40vh]\"><p className=\"text-slate-400 text-sm animate-pulse\">Carregando...</p></div>\n  const pending = probes.filter(p => p.status === 'pending'); const completed = probes.filter(p => p.status === 'completed')\n\n  return (\n    <div className=\"px-4 md:px-8 lg:px-12 xl:px-16 pt-5\">\n      <Link href={`/aba/aprendizes/${learnerId}`} className=\"text-xs text-slate-400 hover:text-aba-500\">← Voltar ao aprendiz</Link>\n      <div className=\"mt-4 mb-6 flex items-start justify-between\">\n        <div><h1 className=\"text-lg font-normal text-slate-800\">Manutenção — Sondas</h1><p className=\"text-xs text-slate-400\">Sondas pós-domínio (2, 6 e 12 semanas)</p></div>\n        {protocolId && <button onClick={handleSchedule} disabled={saving==='schedule'} className=\"px-4 py-2 text-xs bg-aba-500 text-white rounded-lg hover:bg-aba-600 disabled:opacity-50\">{saving==='schedule' ? 'Agendando...' : 'Agendar Sondas 2-6-12'}</button>}\n      </div>\n      {error && <div className=\"mb-4 p-3 bg-red-50 rounded-lg\"><p className=\"text-xs text-red-500\">{error}</p></div>}\n      {success && <div className=\"mb-4 p-3 bg-green-50 rounded-lg\"><p className=\"text-xs text-green-600\">{success}</p></div>}\n\n      {probes.length === 0 ? <div className=\"text-center py-12\"><p className=\"text-sm text-slate-400\">Nenhuma sonda agendada.</p></div> : (<>\n        {pending.length > 0 && (\n          <div className=\"mb-6\">\n            <h2 className=\"text-xs font-medium text-aba-500 uppercase tracking-wider mb-3\">Pendentes ({pending.length})</h2>\n            <div className=\"space-y-2\">{pending.map(p => (\n              <div key={p.id} className=\"p-4 rounded-xl border border-amber-200 bg-amber-50/50\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div><h3 className=\"text-sm font-medium text-slate-800\">{p.label}</h3><p className=\"text-[11px] text-slate-400\">{p.protocol_title} · {new Date(p.scheduled_at).toLocaleDateString('pt-BR')}</p></div>\n                  {new Date(p.scheduled_at) <= new Date() ? <button onClick={() => setEvaluating(evaluating===p.id ? null : p.id)} className=\"px-3 py-1 text-[11px] bg-aba-500 text-white rounded-lg hover:bg-aba-600\">{evaluating===p.id ? 'Cancelar' : 'Avaliar'}</button> : <span className=\"px-2 py-0.5 rounded-full text-[10px] font-medium bg-blue-50 text-blue-500\">Futura</span>}\n                </div>\n                {evaluating === p.id && (\n                  <div className=\"mt-3 pt-3 border-t border-amber-200\">\n                    <div className=\"grid grid-cols-3 gap-3 mb-3\">\n                      <div><label className=\"block text-[11px] text-slate-500 mb-1\">Total tentativas</label><input type=\"number\" min={1} value={form.trials_total} onChange={e => setForm({...form, trials_total:parseInt(e.target.value)||0})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" /></div>\n                      <div><label className=\"block text-[11px] text-slate-500 mb-1\">Corretas</label><input type=\"number\" min={0} value={form.trials_correct} onChange={e => setForm({...form, trials_correct:parseInt(e.target.value)||0})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500\" /></div>\n                      <div><label className=\"block text-[11px] text-slate-500 mb-1\">Nível de dica</label><select value={form.prompt_level} onChange={e => setForm({...form, prompt_level:e.target.value})} className=\"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500 bg-white\">{Object.entries(promptLabels).map(([k,v]) => <option key={k} value={k}>{v}</option>)}</select></div>\n                    </div>\n                    <div className=\"flex justify-end\"><button onClick={() => handleEvaluate(p.id)} disabled={saving===p.id} className=\"px-4 py-1.5 text-xs bg-aba-500 text-white rounded-lg hover:bg-aba-600 disabled:opacity-50\">{saving===p.id ? 'Salvando...' : 'Registrar Resultado'}</button></div>\n                  </div>\n                )}\n              </div>\n            ))}</div>\n          </div>\n        )}\n        {completed.length > 0 && (\n          <div>\n            <h2 className=\"text-xs font-medium text-slate-400 uppercase tracking-wider mb-3\">Concluídas ({completed.length})</h2>\n            <div className=\"space-y-2\">{completed.map(p => (\n              <div key={p.id} className={`p-4 rounded-xl border ${p.result==='passed' ? 'border-green-200 bg-green-50/30' : 'border-red-200 bg-red-50/30'}`}>\n                <div className=\"flex items-center justify-between\">\n                  <div><h3 className=\"text-sm font-medium text-slate-800\">{p.label}</h3><p className=\"text-[11px] text-slate-400\">{p.protocol_title} · {p.trials_correct}/{p.trials_total} ({p.score_pct}%)</p></div>\n                  <span className={`px-2 py-0.5 rounded-full text-[10px] font-medium ${p.result==='passed' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-500'}`}>{p.result==='passed' ? 'Mantida' : 'Regressão'}</span>\n                </div>\n              </div>\n            ))}</div>\n          </div>\n        )}\n      </>)}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}