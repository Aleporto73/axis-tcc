{"version":3,"sources":["../../../../node_modules/lucide-react/src/icons/loader-circle.ts","../../../../app/ativar-lembretes/page.tsx"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M21 12a9 9 0 1 1-6.219-8.56', key: '13zald' }]];\n\n/**\n * @component @name LoaderCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTJhOSA5IDAgMSAxLTYuMjE5LTguNTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/loader-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LoaderCircle = createLucideIcon('loader-circle', __iconNode);\n\nexport default LoaderCircle;\n","'use client'\n\nimport { Suspense, useEffect, useState } from 'react'\nimport { useSearchParams } from 'next/navigation'\nimport { Bell, Check, X, Loader2 } from 'lucide-react'\n\nfunction AtivarLembretesContent() {\n  const searchParams = useSearchParams()\n  const token = searchParams.get('token')\n  \n  const [status, setStatus] = useState<'loading' | 'ready' | 'activating' | 'success' | 'error' | 'denied'>('loading')\n  const [patientName, setPatientName] = useState('')\n  const [errorMsg, setErrorMsg] = useState('')\n\n  useEffect(() => {\n    if (!token) {\n      setStatus('error')\n      setErrorMsg('Link invalido')\n      return\n    }\n    setStatus('ready')\n  }, [token])\n\n  const handleActivate = async () => {\n    if (!('Notification' in window)) {\n      setStatus('error')\n      setErrorMsg('Seu navegador não suporta notificações')\n      return\n    }\n\n    try {\n      setStatus('activating')\n\n      const permission = await Notification.requestPermission()\n      if (permission !== 'granted') {\n        setStatus('denied')\n        return\n      }\n\n      const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js')\n\n      const { initializeApp, getApps } = await import('firebase/app')\n      const { getMessaging, getToken } = await import('firebase/messaging')\n\n      const firebaseConfig = {\n        apiKey: \"AIzaSyCl15IE6pCSWywO-4IiPX0QtLqy4BiXL4E\",\n        authDomain: \"axis-tcc.firebaseapp.com\",\n        projectId: \"axis-tcc\",\n        storageBucket: \"axis-tcc.firebasestorage.app\",\n        messagingSenderId: \"911481168774\",\n        appId: \"1:911481168774:web:8a030d698db7046485c207\"\n      }\n\n      const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0]\n      const messaging = getMessaging(app)\n\n      const fcmToken = await getToken(messaging, {\n        vapidKey: process.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY,\n        serviceWorkerRegistration: registration\n      })\n\n      if (!fcmToken) {\n        setStatus('error')\n        setErrorMsg('Não foi possível ativar notificações')\n        return\n      }\n\n      const res = await fetch('/api/patient/push/authorize', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          patient_token: token,\n          fcm_token: fcmToken,\n          device_info: navigator.userAgent\n        })\n      })\n\n      const data = await res.json()\n\n      if (res.ok) {\n        setPatientName(data.patient_name || '')\n        setStatus('success')\n      } else {\n        setStatus('error')\n        setErrorMsg(data.error || 'Erro ao ativar')\n      }\n\n    } catch (error) {\n      console.error('Erro:', error)\n      setStatus('error')\n      setErrorMsg('Erro ao ativar notificações')\n    }\n  }\n\n  return (\n    <div className=\"bg-white rounded-2xl shadow-lg max-w-md w-full p-8\">\n      {status === 'loading' && (\n        <div className=\"text-center\">\n          <Loader2 className=\"w-12 h-12 animate-spin text-blue-600 mx-auto\" />\n        </div>\n      )}\n\n      {status === 'ready' && (\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-6\">\n            <Bell className=\"w-10 h-10 text-blue-600\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-neutral-900 mb-3\">Ativar Lembretes</h1>\n          <p className=\"text-neutral-600 mb-6\">Receba lembretes das suas sessoes diretamente no seu celular ou computador.</p>\n          <p className=\"text-sm text-neutral-500 mb-8 bg-neutral-50 p-4 rounded-lg\">\n            Você recebera apenas lembretes de horario das suas sessoes. Nenhuma informacao clínica sera enviada.\n          </p>\n          <button onClick={handleActivate} className=\"w-full px-6 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-semibold text-lg transition-colors\">\n            Ativar Notificações\n          </button>\n        </div>\n      )}\n\n      {status === 'activating' && (\n        <div className=\"text-center\">\n          <Loader2 className=\"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4\" />\n          <p className=\"text-neutral-600\">Ativando notificações...</p>\n        </div>\n      )}\n\n      {status === 'success' && (\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-6\">\n            <Check className=\"w-10 h-10 text-emerald-600\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-neutral-900 mb-3\">Lembretes Ativados!</h1>\n          <p className=\"text-neutral-600 mb-4\">{patientName ? `${patientName}, você` : 'Você'} recebera lembretes antes das suas sessoes.</p>\n          <p className=\"text-sm text-neutral-500\">Pode fechar esta página.</p>\n        </div>\n      )}\n\n      {status === 'denied' && (\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-6\">\n            <Bell className=\"w-10 h-10 text-amber-600\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-neutral-900 mb-3\">Permissao Negada</h1>\n          <p className=\"text-neutral-600 mb-6\">Para receber lembretes, você precisa permitir notificações no seu navegador.</p>\n          <button onClick={() => setStatus('ready')} className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium\">\n            Tentar Novamente\n          </button>\n        </div>\n      )}\n\n      {status === 'error' && (\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-6\">\n            <X className=\"w-10 h-10 text-red-600\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-neutral-900 mb-3\">Erro</h1>\n          <p className=\"text-neutral-600\">{errorMsg || 'Não foi possível ativar os lembretes.'}</p>\n        </div>\n      )}\n\n      <div className=\"mt-8 pt-6 border-t border-neutral-100 text-center\">\n        <p className=\"text-xs text-neutral-400\">AXIS TCC - Sistema de Apoio Clínico</p>\n      </div>\n    </div>\n  )\n}\n\nexport default function AtivarLembretesPage() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center p-4\">\n      <Suspense fallback={<div className=\"text-center\"><Loader2 className=\"w-12 h-12 animate-spin text-blue-600 mx-auto\" /></div>}>\n        <AtivarLembretesContent />\n      </Suspense>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}