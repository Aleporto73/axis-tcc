{"version":3,"sources":["../../../../src/database/db.ts","../../../../app/components/SidebarABA.tsx/__nextjs-internal-proxy.mjs","../../../../app/aba/layout.tsx"],"sourcesContent":["import { Pool } from 'pg'\n\nconst pool = new Pool({\n  host: 'localhost',\n  port: 5432,\n  user: 'axis',\n  password: 'AxisTcc2026!',\n  database: 'axis_tcc',\n  max: 10,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 5000,\n})\n\npool.on('error', (err) => {\n  console.error('[AXIS POOL] Erro inesperado:', err.message)\n})\n\nexport async function testConnection() {\n  try {\n    const result = await pool.query('SELECT NOW()')\n    console.log('✅ Conexão com PostgreSQL funcionando!')\n    console.log('⏰ Hora no servidor:', result.rows[0].now)\n    return true\n  } catch (error) {\n    console.error('❌ Erro ao conectar:', error)\n    return false\n  }\n}\n\nexport default pool\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/components/SidebarABA.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/SidebarABA.tsx\",\n    \"default\",\n);\n","import { auth } from '@clerk/nextjs/server'\nimport { redirect } from 'next/navigation'\nimport pool from '@/src/database/db'\nimport SidebarABA from '../components/SidebarABA'\n\nasync function logAccessDenied(\n  tenantId: string,\n  userId: string,\n  reason: string\n): Promise<void> {\n  try {\n    await pool.query(\n      `INSERT INTO axis_audit_logs (tenant_id, user_id, actor, action, entity_type, metadata, created_at)\n       VALUES ($1, $2, 'system', 'MODULE_ACCESS_DENIED', 'module', $3, NOW())`,\n      [tenantId, userId, JSON.stringify({ module: 'aba', reason })]\n    )\n  } catch (err) {\n    console.error('[AXIS AUDIT] FALHA ao registrar DENIED:', {\n      userId, tenantId, reason,\n      error: err instanceof Error ? err.message : String(err),\n    })\n  }\n}\n\nexport default async function ABALayout({ children }: { children: React.ReactNode }) {\n  const { userId } = await auth()\n\n  if (!userId) {\n    redirect('/')\n  }\n\n  const tenantResult = await pool.query(\n    'SELECT id FROM tenants WHERE clerk_user_id = $1 LIMIT 1',\n    [userId]\n  )\n\n  if (!tenantResult.rows[0]?.id) {\n    redirect('/hub')\n  }\n\n  const tenantId = tenantResult.rows[0].id\n\n  const licenseResult = await pool.query(\n    'SELECT is_active FROM user_licenses WHERE clerk_user_id = $1 AND product_type = $2 LIMIT 1',\n    [userId, 'aba']\n  )\n\n  const hasLicense = licenseResult.rows[0]?.is_active === true\n\n  if (!hasLicense) {\n    await logAccessDenied(tenantId, userId, 'no_active_license')\n    redirect('/hub')\n  }\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      <SidebarABA />\n      <main className=\"md:ml-20 min-h-screen pb-20 md:pb-8\">\n        {children}\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":"kJAAA,IAAA,EAAA,EAAA,CAAA,CAAA,yCAEA,IAAM,EAAO,IAAI,EAAA,IAAI,CAAC,CACpB,KAAM,YACN,KAAM,KACN,KAAM,OACN,SAAU,eACV,SAAU,WACV,IAAK,GACL,kBAAmB,IACnB,wBAAyB,GAC3B,GAEA,EAAK,EAAE,CAAC,QAAS,AAAC,IAChB,QAAQ,KAAK,CAAC,+BAAgC,EAAI,OAAO,CAC3D,oBAce,gFC3BA,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,+RAAiS,EAC9T,8DACA,gEAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,2QAA6Q,EAC1S,0CACA,oHCLJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,eAEA,eAAe,EACb,CAAgB,CAChB,CAAc,CACd,CAAc,EAEd,GAAI,CACF,MAAM,EAAA,OAAI,CAAC,KAAK,CACd,CAAC;6EACsE,CAAC,CACxE,CAAC,EAAU,EAAQ,KAAK,SAAS,CAAC,CAAE,OAAQ,aAAO,CAAO,GAAG,CAEjE,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,0CAA2C,QACvD,EAAQ,WAAU,SAClB,MAAO,aAAe,MAAQ,EAAI,OAAO,CAAG,OAAO,EACrD,EACF,CACF,CAEe,eAAe,EAAU,UAAE,CAAQ,CAAiC,EACjF,GAAM,QAAE,CAAM,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,IAAA,AAAI,GAEzB,CAAC,GACH,CAAA,EAAA,EAAA,AADW,QACX,AAAQ,EAAC,KAGX,IAAM,EAAe,MAAM,EAAA,OAAI,CAAC,KAAK,CACnC,0DACA,CAAC,EAAO,CAGL,AAAD,GAAc,IAAI,CAAC,EAAE,EAAE,IAAI,AAC7B,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,QAGX,IAAM,EAAW,EAAa,IAAI,CAAC,EAAE,CAAC,EAAE,CAElC,EAAgB,MAAM,EAAA,OAAI,CAAC,KAAK,CACpC,6FACA,CAAC,EAAQ,MAAM,EAUjB,OAPmB,EAAc,IAAI,CAAC,EAAE,EAAE,aAAc,IAGtD,MAAM,EAAgB,EAAU,EAAQ,qBACxC,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,SAIT,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAU,CAAA,CAAA,GACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+CACb,MAIT","ignoreList":[1]}