module.exports=[52059,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);let f={independent:"Independente",gestural:"Gestual",verbal:"Verbal",modeling:"Modelagem",partial_physical:"Física parcial",full_physical:"Física total"};function g(){let a=(0,d.useParams)(),g=(0,d.useSearchParams)(),h=a.id,i=g.get("protocol_id"),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(80),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)({variation_desc:"",context_desc:"",trials_total:10,trials_correct:0,prompt_level:"independent",notes:""}),B=(0,c.useCallback)(async()=>{if(i){try{let a=await fetch(`/api/aba/generalization?protocol_id=${i}`),b=await a.json();k(b.probes||[]);let c=await fetch(`/api/aba/protocols?learner_id=${h}`),d=await c.json(),e=d.protocols?.find(a=>a.id===i);e&&(m(e.title),o(e.mastery_criteria_pct||80))}catch{}q(!1)}},[i,h]);(0,c.useEffect)(()=>{B()},[B]);let C=(a,b)=>{let c=j.filter(c=>c.variation_number===a&&c.context_number===b)[0]||void 0;return{latest:c,passed:!!c&&c.score_pct>=n}},D=async()=>{if(x&&i){s(!0),u(null),w(null);try{let a=await fetch("/api/aba/generalization",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({protocol_id:i,variation_number:x.v,context_number:x.c,variation_desc:z.variation_desc||null,context_desc:z.context_desc||null,trials_total:z.trials_total,trials_correct:z.trials_correct,prompt_level:z.prompt_level,notes:z.notes||null})}),b=await a.json();a.ok?(b.auto_transitioned?w("Generalização completa! Protocolo → Mantido"):w(`${b.matrix.passing_cells}/6 c\xe9lulas aprovadas`),y(null),A({variation_desc:"",context_desc:"",trials_total:10,trials_correct:0,prompt_level:"independent",notes:""}),B()):u(b.error||"Erro")}catch{u("Falha de conexão")}s(!1)}};if(!i)return(0,b.jsxs)("div",{className:"px-4 pt-8 text-center",children:[(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"protocol_id ausente."}),(0,b.jsx)(e.default,{href:`/aba/aprendizes/${h}`,className:"text-xs text-aba-500 mt-2 inline-block",children:"← Voltar"})]});if(p)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,b.jsx)("p",{className:"text-slate-400 text-sm animate-pulse",children:"Carregando..."})});let E=[1,2,3].flatMap(a=>[1,2].map(b=>C(a,b))).filter(a=>a.passed).length;return(0,b.jsxs)("div",{className:"px-4 md:px-8 lg:px-12 xl:px-16 pt-5",children:[(0,b.jsx)(e.default,{href:`/aba/aprendizes/${h}`,className:"text-xs text-slate-400 hover:text-aba-500",children:"← Voltar ao aprendiz"}),(0,b.jsxs)("div",{className:"mt-4 mb-6",children:[(0,b.jsx)("h1",{className:"text-lg font-normal text-slate-800",children:"Generalização 3×2"}),(0,b.jsxs)("p",{className:"text-xs text-slate-400",children:[l," · Critério: ",n,"% · ",E,"/6 células"]})]}),t&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:(0,b.jsx)("p",{className:"text-xs text-red-500",children:t})}),v&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:(0,b.jsx)("p",{className:"text-xs text-green-600",children:v})}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-px bg-slate-200 rounded-xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Variação"}),(0,b.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Contexto 1"}),(0,b.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Contexto 2"}),[1,2,3].map(a=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-slate-50 p-3 flex items-center justify-center",children:(0,b.jsxs)("span",{className:"text-xs font-medium text-slate-600",children:["V",a]})},`v${a}`),[1,2].map(c=>{let d=C(a,c);return(0,b.jsx)("button",{onClick:()=>y({v:a,c}),className:`p-3 text-center transition-colors ${d.passed?"bg-green-50 hover:bg-green-100":d.latest?"bg-amber-50 hover:bg-amber-100":"bg-white hover:bg-aba-500/5"} ${x?.v===a&&x?.c===c?"ring-2 ring-aba-500":""}`,children:d.latest?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{className:`text-sm font-medium ${d.passed?"text-green-600":"text-amber-600"}`,children:[d.latest.score_pct,"%"]}),(0,b.jsxs)("p",{className:"text-[10px] text-slate-400",children:[d.latest.trials_correct,"/",d.latest.trials_total]})]}):(0,b.jsx)("p",{className:"text-xs text-slate-300",children:"Vazio"})},`${a}-${c}`)})]}))]}),(0,b.jsx)("p",{className:"text-[10px] text-slate-400 mt-2 text-center",children:"Clique numa célula para registrar probe"})]}),x&&(0,b.jsxs)("div",{className:"p-4 rounded-xl border border-aba-500/30 bg-aba-500/5 mb-6",children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-slate-800 mb-3",children:["Probe — V",x.v," × C",x.c]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Descrição variação"}),(0,b.jsx)("input",{type:"text",value:z.variation_desc,onChange:a=>A({...z,variation_desc:a.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500",placeholder:"Ex: Com brinquedo diferente"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Descrição contexto"}),(0,b.jsx)("input",{type:"text",value:z.context_desc,onChange:a=>A({...z,context_desc:a.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500",placeholder:"Ex: Na sala de espera"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Total tentativas"}),(0,b.jsx)("input",{type:"number",min:1,value:z.trials_total,onChange:a=>A({...z,trials_total:parseInt(a.target.value)||0}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Corretas"}),(0,b.jsx)("input",{type:"number",min:0,value:z.trials_correct,onChange:a=>A({...z,trials_correct:parseInt(a.target.value)||0}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Nível de dica"}),(0,b.jsx)("select",{value:z.prompt_level,onChange:a=>A({...z,prompt_level:a.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500 bg-white",children:Object.entries(f).map(([a,c])=>(0,b.jsx)("option",{value:a,children:c},a))})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:()=>y(null),className:"px-3 py-1.5 text-xs text-slate-500",children:"Cancelar"}),(0,b.jsx)("button",{onClick:D,disabled:r,className:"px-4 py-1.5 text-xs bg-aba-500 text-white rounded-lg hover:bg-aba-600 disabled:opacity-50",children:r?"Salvando...":"Registrar Probe"})]})]})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=app_aba_aprendizes_%5Bid%5D_generalizacao_page_tsx_a9e3b3ca._.js.map