(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,663,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(22016);let l={draft:"Rascunho",active:"Ativo",completed:"Concluído",archived:"Arquivado"},i={draft:"bg-slate-100 text-slate-500",active:"bg-green-50 text-green-600",completed:"bg-blue-50 text-blue-600",archived:"bg-slate-50 text-slate-400"},n={draft:"Rascunho",active:"Ativo",mastered:"Dominado",generalization:"Generalização",maintained:"Mantido",archived:"Arquivado",suspended:"Suspenso",discontinued:"Descontinuado"};function r(){let[e,r]=(0,a.useState)([]),[d,o]=(0,a.useState)(!0),[c,x]=(0,a.useState)(null),[m,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)([]),[b,g]=(0,a.useState)(!1),[f,j]=(0,a.useState)({learner_id:"",title:"",start_date:new Date().toISOString().split("T")[0]}),[v,N]=(0,a.useState)([{title:"",domain:"Comunicação",target_pct:80,notes:""}]),y=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/aba/pei"),t=await e.json();r(t.plans||[]),o(!1)}catch{x("Falha ao carregar"),o(!1)}},[]);(0,a.useEffect)(()=>{y()},[y]),(0,a.useEffect)(()=>{m&&0===h.length&&fetch("/api/aba/learners").then(e=>e.json()).then(e=>p(e.learners||[])).catch(()=>{})},[m,h.length]);let w=(e,t,a)=>{let s=[...v];s[e]={...s[e],[t]:a},N(s)},C=async()=>{if(!f.learner_id||!f.title)return void x("Preencha aprendiz e título");let e=v.filter(e=>e.title.trim());if(0===e.length)return void x("Adicione pelo menos 1 meta");g(!0),x(null);try{let t=await fetch("/api/aba/pei",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...f,goals:e})});if(!t.ok){let e=await t.json();x(e.error||"Erro"),g(!1);return}u(!1),j({learner_id:"",title:"",start_date:new Date().toISOString().split("T")[0]}),N([{title:"",domain:"Comunicação",target_pct:80,notes:""}]),await y()}catch{x("Falha de conexão")}g(!1)},k=["Comunicação","Social","Acadêmico","Autocuidado","Motor","Comportamento","Brincar","Cognitivo"];return d?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,t.jsx)("div",{className:"animate-pulse text-slate-400 text-sm",children:"Carregando..."})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex justify-center pt-5 md:pt-6 mb-6 md:mb-8 px-4",children:(0,t.jsxs)("nav",{className:"inline-flex items-center gap-1 bg-white border border-slate-200 rounded-full px-3 md:px-5 py-1.5 shadow-sm",children:[(0,t.jsx)(s.default,{href:"/aba",className:"px-3 py-1 text-sm font-medium text-slate-400 hover:text-slate-600 transition-colors",children:"Painel"}),(0,t.jsx)("span",{className:"text-slate-300 text-xs",children:"·"}),(0,t.jsx)(s.default,{href:"/aba/aprendizes",className:"px-3 py-1 text-sm font-medium text-slate-400 hover:text-slate-600 transition-colors",children:"Aprendizes"}),(0,t.jsx)("span",{className:"text-slate-300 text-xs",children:"·"}),(0,t.jsx)(s.default,{href:"/aba/pei",className:"px-3 py-1 text-sm font-medium text-aba-500",children:"PEI"})]})}),(0,t.jsxs)("div",{className:"px-4 md:px-8 lg:px-12 xl:px-16",children:[(0,t.jsxs)("header",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-lg font-normal text-slate-400 tracking-tight mb-0",children:"Plano Educacional Individualizado"}),(0,t.jsx)("p",{className:"text-xs text-slate-300 font-light",children:"Metas semestrais vinculadas aos protocolos ABA"})]}),c&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:(0,t.jsx)("p",{className:"text-xs text-red-500",children:c})}),(0,t.jsxs)("div",{className:"max-w-4xl",children:[(0,t.jsx)("button",{onClick:()=>u(!0),className:"w-full p-3 rounded-xl border-2 border-dashed border-aba-500/30 text-aba-500 text-sm font-medium hover:bg-aba-500/5 transition-colors mb-6",children:"+ Novo PEI"}),0===e.length?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-aba-500/10 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-aba-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Nenhum PEI cadastrado"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Crie um Plano Educacional Individualizado para começar"})]}):(0,t.jsx)("div",{className:"space-y-6",children:e.map(e=>{let a=e.goals.filter(t=>e.linked_protocols.filter(e=>e.pei_goal_id===t.id).some(e=>["mastered","generalization","maintained","archived"].includes(e.status))).length;return(0,t.jsxs)("div",{className:"border border-slate-200 rounded-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-slate-700",children:e.title}),(0,t.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full "+(i[e.status]||"bg-slate-100 text-slate-500"),children:l[e.status]||e.status})]}),(0,t.jsxs)("p",{className:"text-xs text-slate-400 mt-0.5",children:[e.learner_name," · Início: ",new Date(e.start_date).toLocaleDateString("pt-BR"),e.end_date?" · Fim: "+new Date(e.end_date).toLocaleDateString("pt-BR"):""]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-lg font-medium text-aba-500",children:[a,"/",e.goals.length]}),(0,t.jsx)("p",{className:"text-[10px] text-slate-400",children:"metas atingidas"})]})]}),(0,t.jsxs)("div",{className:"p-5",children:[(0,t.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 mb-4",children:(0,t.jsx)("div",{className:"bg-aba-500 h-2 rounded-full transition-all",style:{width:e.goals.length>0?a/e.goals.length*100+"%":"0%"}})}),(0,t.jsx)("div",{className:"space-y-3",children:e.goals.map(a=>{let s=e.linked_protocols.filter(e=>e.pei_goal_id===a.id),l=s.some(e=>["mastered","generalization","maintained","archived"].includes(e.status));return(0,t.jsxs)("div",{className:"p-3 rounded-lg border "+(l?"border-green-200 bg-green-50/50":"border-slate-200"),children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 "+(l?"bg-green-100":"bg-slate-100"),children:l?(0,t.jsx)("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-slate-300"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-medium text-slate-700",children:a.title}),(0,t.jsxs)("p",{className:"text-[10px] text-slate-400",children:[a.domain," · Meta: ",a.target_pct,"%"]}),a.notes&&(0,t.jsx)("p",{className:"text-[10px] text-slate-400 italic mt-0.5",children:a.notes})]})]})}),s.length>0&&(0,t.jsx)("div",{className:"mt-2 ml-7 flex flex-wrap gap-1",children:s.map(e=>(0,t.jsxs)("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-aba-500/10 text-aba-500",children:[e.title," · ",n[e.status]||e.status]},e.id))}),0===s.length&&(0,t.jsx)("p",{className:"mt-1 ml-7 text-[10px] text-slate-300 italic",children:"Nenhum protocolo vinculado"})]},a.id)})})]})]},e.id)})})]})]}),m&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",onClick:()=>u(!1),children:(0,t.jsx)("div",{className:"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-slate-800",children:"Novo PEI"}),(0,t.jsx)("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-slate-600 text-xl leading-none",children:"×"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Aprendiz *"}),(0,t.jsxs)("select",{value:f.learner_id,onChange:e=>j({...f,learner_id:e.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Selecione"}),h.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Título do PEI *"}),(0,t.jsx)("input",{type:"text",value:f.title,onChange:e=>j({...f,title:e.target.value}),placeholder:"Ex: PEI Semestre 1 - 2026",className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Data de início *"}),(0,t.jsx)("input",{type:"date",value:f.start_date,onChange:e=>j({...f,start_date:e.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:border-aba-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-slate-600",children:"Metas *"}),(0,t.jsx)("button",{onClick:()=>{N([...v,{title:"",domain:"Comunicação",target_pct:80,notes:""}])},className:"text-[11px] text-aba-500 hover:text-aba-600 font-medium",children:"+ Adicionar meta"})]}),(0,t.jsx)("div",{className:"space-y-3",children:v.map((e,a)=>(0,t.jsxs)("div",{className:"p-3 border border-slate-200 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-[10px] text-slate-400",children:["Meta ",a+1]}),v.length>1&&(0,t.jsx)("button",{onClick:()=>{v.length>1&&N(v.filter((e,t)=>t!==a))},className:"text-[10px] text-red-400 hover:text-red-500",children:"Remover"})]}),(0,t.jsx)("input",{type:"text",value:e.title,onChange:e=>w(a,"title",e.target.value),placeholder:"Descrição da meta",className:"w-full px-3 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("select",{value:e.domain,onChange:e=>w(a,"domain",e.target.value),className:"flex-1 px-2 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500 bg-white",children:k.map(e=>(0,t.jsx)("option",{value:e,children:e},e))}),(0,t.jsx)("input",{type:"number",min:50,max:100,value:e.target_pct,onChange:e=>w(a,"target_pct",parseInt(e.target.value)||80),className:"w-20 px-2 py-1.5 rounded-lg border border-slate-200 text-xs focus:outline-none focus:border-aba-500",placeholder:"%"})]})]},a))})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6 pt-4 border-t border-slate-100",children:[(0,t.jsx)("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 rounded-lg border border-slate-200 text-sm text-slate-500 hover:bg-slate-50",children:"Cancelar"}),(0,t.jsx)("button",{onClick:C,disabled:b,className:"flex-1 px-4 py-2 rounded-lg bg-aba-500 text-white text-sm font-medium hover:bg-aba-500/90 disabled:opacity-50 transition-colors",children:b?"Criando...":"Criar PEI"})]})]})})})]})}e.s(["default",()=>r])}]);