(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54552,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),l=e.i(22016);let r={independent:"Independente",gestural:"Gestual",verbal:"Verbal",modeling:"Modelagem",partial_physical:"Física parcial",full_physical:"Física total"};function n(){let e=(0,s.useParams)(),n=(0,s.useSearchParams)(),i=e.id,c=n.get("protocol_id"),[o,d]=(0,a.useState)([]),[x,p]=(0,a.useState)(""),[m,u]=(0,a.useState)(80),[b,h]=(0,a.useState)(!0),[g,v]=(0,a.useState)(!1),[j,f]=(0,a.useState)(null),[_,N]=(0,a.useState)(null),[y,C]=(0,a.useState)(null),[w,S]=(0,a.useState)({variation_desc:"",context_desc:"",trials_total:10,trials_correct:0,prompt_level:"independent",notes:""}),k=(0,a.useCallback)(async()=>{if(c){try{let e=await fetch(`/api/aba/generalization?protocol_id=${c}`),t=await e.json();d(t.probes||[]);let a=await fetch(`/api/aba/protocols?learner_id=${i}`),s=await a.json(),l=s.protocols?.find(e=>e.id===c);l&&(p(l.title),u(l.mastery_criteria_pct||80))}catch{}h(!1)}},[c,i]);(0,a.useEffect)(()=>{k()},[k]);let $=(e,t)=>{let a=o.filter(a=>a.variation_number===e&&a.context_number===t)[0]||void 0;return{latest:a,passed:!!a&&a.score_pct>=m}},z=async()=>{if(y&&c){v(!0),f(null),N(null);try{let e=await fetch("/api/aba/generalization",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({protocol_id:c,variation_number:y.v,context_number:y.c,variation_desc:w.variation_desc||null,context_desc:w.context_desc||null,trials_total:w.trials_total,trials_correct:w.trials_correct,prompt_level:w.prompt_level,notes:w.notes||null})}),t=await e.json();e.ok?(t.auto_transitioned?N("Generalização completa! Protocolo → Mantido"):N(`${t.matrix.passing_cells}/6 c\xe9lulas aprovadas`),C(null),S({variation_desc:"",context_desc:"",trials_total:10,trials_correct:0,prompt_level:"independent",notes:""}),k()):f(t.error||"Erro")}catch{f("Falha de conexão")}v(!1)}};if(!c)return(0,t.jsxs)("div",{className:"px-4 pt-8 text-center",children:[(0,t.jsx)("p",{className:"text-slate-400 text-sm",children:"protocol_id ausente."}),(0,t.jsx)(l.default,{href:`/aba/aprendizes/${i}`,className:"text-xs text-aba-500 mt-2 inline-block",children:"← Voltar"})]});if(b)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,t.jsx)("p",{className:"text-slate-400 text-sm animate-pulse",children:"Carregando..."})});let P=[1,2,3].flatMap(e=>[1,2].map(t=>$(e,t))).filter(e=>e.passed).length;return(0,t.jsxs)("div",{className:"px-4 md:px-8 lg:px-12 xl:px-16 pt-5",children:[(0,t.jsx)(l.default,{href:`/aba/aprendizes/${i}`,className:"text-xs text-slate-400 hover:text-aba-500",children:"← Voltar ao aprendiz"}),(0,t.jsxs)("div",{className:"mt-4 mb-6",children:[(0,t.jsx)("h1",{className:"text-lg font-normal text-slate-800",children:"Generalização 3×2"}),(0,t.jsxs)("p",{className:"text-xs text-slate-400",children:[x," · Critério: ",m,"% · ",P,"/6 células"]})]}),j&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:(0,t.jsx)("p",{className:"text-xs text-red-500",children:j})}),_&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:(0,t.jsx)("p",{className:"text-xs text-green-600",children:_})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-px bg-slate-200 rounded-xl overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Variação"}),(0,t.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Contexto 1"}),(0,t.jsx)("div",{className:"bg-slate-50 p-2 text-center text-[10px] font-medium text-slate-500 uppercase",children:"Contexto 2"}),[1,2,3].map(e=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-slate-50 p-3 flex items-center justify-center",children:(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-600",children:["V",e]})},`v${e}`),[1,2].map(a=>{let s=$(e,a);return(0,t.jsx)("button",{onClick:()=>C({v:e,c:a}),className:`p-3 text-center transition-colors ${s.passed?"bg-green-50 hover:bg-green-100":s.latest?"bg-amber-50 hover:bg-amber-100":"bg-white hover:bg-aba-500/5"} ${y?.v===e&&y?.c===a?"ring-2 ring-aba-500":""}`,children:s.latest?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:`text-sm font-medium ${s.passed?"text-green-600":"text-amber-600"}`,children:[s.latest.score_pct,"%"]}),(0,t.jsxs)("p",{className:"text-[10px] text-slate-400",children:[s.latest.trials_correct,"/",s.latest.trials_total]})]}):(0,t.jsx)("p",{className:"text-xs text-slate-300",children:"Vazio"})},`${e}-${a}`)})]}))]}),(0,t.jsx)("p",{className:"text-[10px] text-slate-400 mt-2 text-center",children:"Clique numa célula para registrar probe"})]}),y&&(0,t.jsxs)("div",{className:"p-4 rounded-xl border border-aba-500/30 bg-aba-500/5 mb-6",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-slate-800 mb-3",children:["Probe — V",y.v," × C",y.c]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Descrição variação"}),(0,t.jsx)("input",{type:"text",value:w.variation_desc,onChange:e=>S({...w,variation_desc:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500",placeholder:"Ex: Com brinquedo diferente"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Descrição contexto"}),(0,t.jsx)("input",{type:"text",value:w.context_desc,onChange:e=>S({...w,context_desc:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500",placeholder:"Ex: Na sala de espera"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Total tentativas"}),(0,t.jsx)("input",{type:"number",min:1,value:w.trials_total,onChange:e=>S({...w,trials_total:parseInt(e.target.value)||0}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Corretas"}),(0,t.jsx)("input",{type:"number",min:0,value:w.trials_correct,onChange:e=>S({...w,trials_correct:parseInt(e.target.value)||0}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Nível de dica"}),(0,t.jsx)("select",{value:w.prompt_level,onChange:e=>S({...w,prompt_level:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:border-aba-500 bg-white",children:Object.entries(r).map(([e,a])=>(0,t.jsx)("option",{value:e,children:a},e))})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>C(null),className:"px-3 py-1.5 text-xs text-slate-500",children:"Cancelar"}),(0,t.jsx)("button",{onClick:z,disabled:g,className:"px-4 py-1.5 text-xs bg-aba-500 text-white rounded-lg hover:bg-aba-600 disabled:opacity-50",children:g?"Salvando...":"Registrar Probe"})]})]})]})}e.s(["default",()=>n])}]);